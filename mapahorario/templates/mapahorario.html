{% extends 'base.html' %}
{% load static %}

{% block 'title' %}Mapa de Horário{% endblock %}

{% block 'head' %}
    <link rel="stylesheet" href="{% static 'mapahorario/css/mapahorario.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://unpkg.com/htmx.org"></script>

    <style>
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; }
        td[contenteditable="true"]:focus { background-color: #f0f8ff; outline: none; }
    </style>

    <script>
        // Adiciona o CSRF token em todas as requisições HTMX
        document.body.addEventListener('htmx:configRequest', (event) => {
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            event.detail.headers['X-CSRFToken'] = csrfToken;
        });
    </script>
{% endblock %}

{% block 'dashboard' %}
<div class="container">
    <div class="row">
        <div onclick="exibir_form('1')" class="col-md card-dashboard">
            <p class="text-card">Sala Heliana</p>
        </div>
        <div onclick="exibir_form('2')" class="col-md card-dashboard">
            <p class="text-card">Sala Poliana</p>
        </div>
    </div>

    <div class="container" id="sala1">
        <!-- CSRF Token -->
        <form method="POST">
            {% csrf_token %}
            <table>
                <thead>
                    <tr>
                        <th>Horario</th>
                        <th>Comp_01</th>
                        <th>Comp_02</th>
                        <th>Comp_03</th>
                        <th>Comp_04</th>
                        <th>Comp_05</th>
                        <th>Comp_06</th>
                        <th>Comp_07</th>
                        <th>Comp_08</th>
                        <th>Comp_09</th>
                        <th>Comp_10</th>
                        <th>Comp_11</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in schedule %}
                    <tr>
                        <td>{{ row.horario }}</td>

                        <!-- Cada célula com HX POST e CSRF token -->
                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_01' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_01 }}">
                            {{ row.HSeg8comp_01 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_02' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_02 }}">
                            {{ row.HSeg8comp_02 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_03' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_03 }}">
                            {{ row.HSeg8comp_03 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_04' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_04 }}">
                            {{ row.HSeg8comp_04 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_05' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_05 }}">
                            {{ row.HSeg8comp_05 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_06' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_06 }}">
                            {{ row.HSeg8comp_06 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_07' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_07 }}">
                            {{ row.HSeg8comp_07 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_08' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_08 }}">
                            {{ row.HSeg8comp_08 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_09' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_09 }}">
                            {{ row.HSeg8comp_09 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_10' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_10 }}">
                            {{ row.HSeg8comp_10 }}
                        </td>

                        <td hx-post="{% url 'update_schedule' row.id 'HSeg8comp_11' %}"
                            hx-trigger="blur"
                            hx-target="this"
                            hx-swap="outerHTML"
                            contenteditable="true"
                            onfocus="this.style.backgroundColor='#f0f8ff'"
                            onblur="this.style.backgroundColor='transparent'"
                            data-initial-value="{{ row.HSeg8comp_11 }}">
                            {{ row.HSeg8comp_11 }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </form>
    </div>
</div>

<!-- Bootstrap JS and dependencies -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script src="{% static 'mapahorario/js/mapahorario.js' %}"></script>
{% endblock %}
